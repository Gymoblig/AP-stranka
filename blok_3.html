<!DOCTYPE html>
<html lang="sk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Architektúra Počítačov</title>
  <link rel="stylesheet" href="styles.css">
  <link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&display=swap" rel="stylesheet">
  <link rel="icon" type="image/png" href="assets/img/logo.jpg">
</head>
<body>
  <div id="loader" class="loader"></div>
  <div id="content" class="content">
    <header id="intro-header">
        <h1 id="intro-text">BLOK 3</h1>
        <h3>Tu už treba všetko :))</h3>
        <div class="button-container">
          <a href="#nutne"><button class="ulohy">Nutný Úvod</button></a>
          <a href="#pohlad"><button class="ulohy">Základný Pohľad na zadanie</button></a>
          <a href="#sockety"><button class="ulohy">Sockety</button></a>
          <a href="#uvodne"><button class="ulohy">1. Úvodné nastavenia</button></a>
          <a href="#pripojenie"><button class="ulohy">2. Pripojenie sa</button></a>
          <a href="#posielanie"><button class="ulohy">3. Posielanie dát</button></a>
          <a href="#prijatie"><button class="ulohy">4. Prijímanie dát</button></a>
          <a href="#zavretie"><button class="ulohy">5. Zavretie socketu</button></a>
          <a href="#nacitanie"><button class="ulohy">Načítanie vstupu z konzoly aj s medzerami</button></a>
          <a href="#praca"><button class="ulohy">Práca s prijatými dátami</button></a>
          <a href="#windows"><button class="ulohy">Problém s Windows 11</button></a>
          <a href="#body"><button class="ulohy">Bodové ohodnotenie</button></a>

        </div>
        
        <button id="hamburger-menu" class="hamburger-menu">
          <span class="bar"></span>
          <span class="bar"></span>
          <span class="bar"></span>
        </button>
      </header>
      
      <nav id="mobile-menu" class="mobile-menu">
        <ul>
          <li><a href="index.html">Hlavná Stránka</a></li>
          <li><a href="blok_1.html">Blok 1</a></li>
          <li><a href="blok_2.html">Blok 2</a></li>
          <li><a href="blok_3.html" >Blok 3</a></li>
          <li><a href="#nutne">Nutný Úvod</a></li>
<li><a href="#pohlad">Základný Pohľad na zadanie</a></li>
<li><a href="#sockety">Sockety</a></li>
<li><a href="#uvodne">1. Úvodné nastavenia</a></li>
<li><a href="#pripojenie">2. Pripojenie sa</a></li>
<li><a href="#posielanie">3. Posielanie dát</a></li>
<li><a href="#prijatie">4. Prijímanie dát</a></li>
<li><a href="#zavretie">5. Zavretie socketu</a></li>
<li><a href="#nacitanie">Načítanie vstupu z konzoly aj s medzerami</a></li>
<li><a href="#praca">Práca s prijatými dátami</a></li>
<li><a href="#windows">Problém s Windows 11</a></li>
<li><a href="#body">Bodové ohodnotenie</a></li>

        </ul>
      </nav>
      
    <button id="theme-switcher" class="theme-switcher">
      <img id="theme-icon" src="" alt="Theme icon">
    </button>
    
    <div id="main-content">
      <div id="" class="section">
        <h2>Ako urobiť BLOK 3?</h2>
        <p>V treťom bloku cvičení budeme komunikovať naprieč internetom so serverom. Vašou úlohou bude naprogramovať “klientský program” schopný posielať a prijímať textové správy. Jedná sa o jeden rozsiahlejší projekt, ktorý budete riešiť počas celého tretieho bloku. V prvej fáze budete mať za úlohu pripojiť sa na server a identifikovať sa svojím osobným číslom. Ďalej musíte vedieť prijať správu zo servera a zobraziť ju na obrazovke. Ak sa Vám to podarí, tak Vás Morfeus osloví Vaším vlastným menom a zadá Vám úlohy, ktoré musíte splniť. Ak sa Vám podarí všetky splniť, plný počet 12 bodov za tretí blok je Váš :)</p>
        <iframe style="width:auto" src="https://www.youtube.com/embed/LI_4v__IVTg" title="Neo searching for Morpheus" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>
      </div>

      <div id="nutne" class="section">
        <h2>NUTNÝ MALÝ TEORETICKÝ ÚVOD (aka yapping)</h2>
        <p>Komunikácia počítačov cez internet je veľmi zjednodušene povedané len posielanie jednotiek a núl z Vášho počítača na počítač na druhej strane a opačne. Je to samozrejme oveľa sofistikovanejšie, no pre potreby tohto projektu Vám stačí vedieť, že budete komunikovať prostredníctvom protokolu TCP/IP, ktorý zabezpečuje, aby sa Vaše jednotky a nuly dostali na počítač na druhej strane v poriadku.</p>
        <p>Aby Váš počítač vedel, na ktorý počítač z miliónov strojov na celom svete má dáta poslať, musí existovať nejaký systém adresovania. Funguje to podobne ako pošta – obálka Vám príde na konkrétnu ulicu, do konkrétnej schránky. Z hľadiska tejto analógie je v prípade internetu ulica a číslo domu tzv. IP adresa, a konkrétna schránka v rámci domu sa nazýva port. Tak ako v paneláku býva viacero ľudí, tak aj vo Vašom počítači môže bežať viacero aplikácií, ktoré prostredníctvom internetu komunikujú. Váš operačný systém preto musí vedieť, ktorej aplikácii má čo poslať. Práve na to slúži číslo portu. </p>
        <p>Teraz zistite Vašu IP adresu. Spustite si konzolu (program, v ktorom ste kompilovali úvodné zadanie semestra) a napíšte:</p>
        <ul><p style="color: #44ff00;">ipconfig</p></ul>
        <p>Vo výpise viete nájsť IP adresu. Ako vidíte, skladá sa zo štyroch bajtov oddelených bodkami:</p>
        <ul><p style="color: #44ff00;">192.168.0.132</p></ul>
        <p>Ďalej si vyskúšajte príkaz ping. Pomocou neho viete otestovať funkčnosť servera, ktorý má takéto testovanie povolené na svojej strane. Skúste otestovať napríklad:</p>
        <ul><p style="color: #44ff00;">ping www.google.com</p></ul>
        <p>Výstup bude vyzerať podobne tomuto (Všimnite si ako krátko celá operácia trvá. Jednotky a nuly sa dostanú z Vášho počítača na server google-u a späť v zlomku sekundy):</p>
        <img src="assets/img/blok2/maxresdefault.jpg" style="width:50%; border:2px #44ff00 solid;margin-left:100px;">
      </div>


      <div id="pohlad" class="section">
        <h2>ZÁKLADNÝ POHĽAD NA ZADANIE</h2>
        <ol>
          <li>Pripojiť sa na server s IP adresou 147.175.115.34 na port 777 pomocou protokolu TCP.</li>
          <li>Poslať úvodnú správu (zobraziť ju v konzole).</li>
          <li>Prijať odpoveď (zobraziť ju v konzole).</li>
          <li>Postupovať podľa ďalších príkazov prijatých v komunikácii so serverom. Komunikácia funguje tak, že vždy po tom, čo Vám server niečo pošle očakáva nejakú odpoveď od Vás.</li>
        </ol>
        <p>(bodové hodnotenie je komplexné a bude zhrnuté dolu, hodnotí sa celý projekt, štruktúra a funkčnosť kódu, vizuálna stránka, ako aj splnenie úloh)</p>
        
      </div>


      <div id="sockety" class="section">
        <h2>SOCKETY</h2>
        <p>Na komunikáciu cez internet z Vášho programu budete používať tzv. sockety, v OS Windows budeme používať implementáciu Winsock. Podpora v rámci predmetu sa poskytuje výlučne pre Windows. Kto si však trúfa, môže skúsiť v operačnom systéme na báze Linux-u. Príklad na implementáciu socket komunikácie je tu. Vo Visual Studio treba pridať nasledovné knižnice:</p>
        <p>Ak pracujete v Dev-C++, musíte nalinkovať knižnice cez Tools -> Compiler Options a tam napísať to, čo je na tomto screenshote.</p>
        <img src="assets/img/blok3/link_veci_k_devku.png" style="width:50%; border:2px #44ff00 solid;margin-left:100px;">
        <p>Ak pracujete v CLione, musíte si nalinkovať knižnice modifikovaním CMakeLists.txt a doplnit target libraries ako v tomto screenshote.</p>
        <img src="assets/img/blok3/linkovanieVclione.png" style="width:50%; border:2px #44ff00 solid;margin-left:100px;">
        <pre>
          #include <stdio.h>
          #include <winsock2.h>
          #include <ws2tcpip.h>
          
          #pragma comment(lib, "Ws2_32.lib")
          </pre>
      </div>


      <div id="uvod" class="section">
        <h2>1. Úvodné nastavenia</h2>
        <p>Najprv treba nastaviť základné parametre štruktúr socketu, IP adresu servera a port, na ktorom chcete komunikovať. Prejdite si každý riadok kódu, nepracujte len systémom “copy/paste”.</p>
          <pre>
//uvodne nastavovacky

WSADATA wsaData;    //struktura WSADATA pre pracu s Winsock
int iResult;

// Initialize Winsock
iResult = WSAStartup(MAKEWORD(2, 2), &wsaData);     //zakladna inicializacia
if (iResult != 0)     //kontrola, ci nestala chyba
{
     printf(“WSAStartup failed: %d\n”, iResult);
     return 1;
}

struct addrinfo *result = NULL, *ptr = NULL;     //struktura pre pracu s adresami
struct addrinfo hints;

ZeroMemory(&hints, sizeof(hints));
hints.ai_family = AF_UNSPEC;
hints.ai_socktype = SOCK_STREAM;
hints.ai_protocol = IPPROTO_TCP;     //pracujeme s protokolom TCP/IP

// Resolve the server address and port
iResult = getaddrinfo(“tu ma byt IP adresa servera”, “tu ma byt port”, &hints, &result);
if (iResult != 0)     //kontrola, ci nenastala chyba
{
     printf(“getaddrinfo failed: %d\n”, iResult);
     WSACleanup();
     return 1;
}
else
     printf(“getaddrinfo didn’t fail…\n”);
          </pre>
      </div>

      <div id="pripojenie" class="section">
        <h2>2. Pripojenie sa</h2>
        <p>V tejto časti kódu sa snažíme pripojiť na server spôsobom, ktorý sme definovali v časti predošlej.</p>
        <pre>
//vytvorenie socketu a pripojenie sa

SOCKET ConnectSocket = INVALID_SOCKET;

// Attempt to connect to the first address returned by
// the call to getaddrinfo
ptr = result;

// Create a SOCKET for connecting to server => pokus o vytvorenie socketu
ConnectSocket = socket(ptr->ai_family, ptr->ai_socktype,ptr->ai_protocol);

if (ConnectSocket == INVALID_SOCKET)     //kontrola, ci nenastala chyba 
{
     printf(“Error at socket(): %ld\n”, WSAGetLastError());
     freeaddrinfo(result);
     WSACleanup();
     return 1;
}
else
     printf(“Error at socket DIDN’T occur…\n”);

// Connect to server. => pokus o pripojenie sa na server

iResult = connect(ConnectSocket, ptr->ai_addr, (int)ptr->ai_addrlen);
if (iResult == SOCKET_ERROR)     //kontrola, ci nenastala chyba
     printf(“Not connected to server…\n”);
else
     printf(“Connected to server!\n”);

if (iResult == SOCKET_ERROR)    //osetrenie chyboveho stavu
{
    closesocket(ConnectSocket);
    ConnectSocket = INVALID_SOCKET;
    WSACleanup();
    return 1;
}

Sleep(250);

 
        </pre>
      </div>

      <div id="posielanie" class="section">
        <h2>3. Posielanie dát</h2>
        <p>Pri posielaní dát v zásade pracujeme z reťazcami ako aj v predošlých blokoch. Posielame znaky, čo sú v konečnom dôsledku jednotky a nuly, ktoré server prijme. Musíte si zvoliť vhodnú dĺžku reťazca, za každým ho naplniť znakmi, ktoré chcete poslať a následne “posunút” reťazec vytvorenému socketu, ktorý sa pokúsi dáta poslať.</p>
        <pre>
//posielanie

char sendbuf[/*treba zavolit vhodnu velkost, napr. 4096*/]; //buffer (v zasade retazec), kam sa budu ukladat data, ktore chcete posielat

iResult = send(ConnectSocket, sendbuf, (int)strlen(sendbuf), 0);
if (iResult == SOCKET_ERROR)
{
     printf(“send failed: %d\n”, WSAGetLastError());
     closesocket(ConnectSocket);
     WSACleanup();
     return 1;
} 

printf(“Bytes Sent: %ld\n”, iResult);     //vypisanie poctu odoslanych dat
        </pre>
      </div>

      <div id="prijatie" class="section">
        <h2>4. Prijímanie dát</h2>
        <p>Aby Vám server vedel odpovedať, musíte si nachystať buffer, do ktorého si budete ukladať dáta, ktoré Vám pošle. V našom prípade sa bude takmer vždy jednať o znaky, takže si ich môžete ukladať do reťazca. </p>
        <pre>
//prijimanie

#define DEFAULT_BUFLEN 4096 //makro, kde definujeme velkost prijimacieho buffera

int recvbuflen = DEFAULT_BUFLEN;
char recvbuf[DEFAULT_BUFLEN];

iResult = recv(ConnectSocket, recvbuf, recvbuflen, 0);     //funkcia na príjimanie

if ( iResult > 0 )
     printf(“Bytes received: %d\n”, iResult);     //prisli validne data, vypis poctu
else if ( iResult == 0 )
     printf(“Connection closed\n”);     //v tomto pripade server ukoncil komunikaciu
else
     printf(“recv failed with error: %d\n”, WSAGetLastError());     //ina chyba
        </pre>
      </div>

      <div id="zavretie" class="section">
        <h2>5. Zavretie socketu</h2>
        <p>Po ukončení komunikácie je potrebné socket zavrieť.</p>
        <pre>
//zavretie socketu

closesocket(ConnectSocket);
WSACleanup();
        </pre>
      </div>

      <div id="nacitanie" class="section">
        <h2>Načítanie vstupu s konzoly aj s medzerami</h2>
        <p>Funkcia scanf() Vám štandardne ukončí načítanie reťazca zo vstupu po výskyte prvej medzery. Ak chcete uložiť vstup vrátane medzier je lepšie použiť funkciu fgets():</p>
        <ul>
          <li>char name[1024];</li>
          <li>int size = 1024;</li>
          <li>fgets(name, size, stdin);</li>
          <li>printf(“%s\n”, name);</li>

        </ul>
        
      </div>

      <div id="praca" class="section">
        <h2>Práca s prijatými dátamii</h2>
        <p>Z pohľadu socketu sú prijaté dáta len postupnosťou bajtov, nie reťazce. V prijatých dátach sa ani nemusí nachádzať ukončovacia nula (všetci viete, čím je ukončený reťazec, však?). Ako teda zistiť, kedy “končia” dáta, ktoré Vám server posiela v našom prípade? Vo väčšine správ sú ukončené znakom ‘\n’. Aby sa Vám v konzole pri vypísaní prijatých dát nevyskytol nejaký neporiadok, musíte tento znak nahradiť ukončovacou nulou ‘\0’. Môžete na to použiť napríklad <a href="https://fresh2refresh.com/c-programming/c-strings/c-strchr-function/">túto funkciu</a>. Lokalizujete znak ‘\n’ a n hradíte ho ukončovacou nulou.
          V jednom špecifickom prípade sa však nebudete môcť spoľahnút ani na znak ‘\n’. Vtedy budete musieť ukončovaciu nulu umiestniť manuálne na základe informácie, ktorá Vám bude včas doručená.</p>
        
      </div>

      <div id="windows" class="section">
        <h2>Ak vám vo Windows 11 nefunguje umiestňovanie znakov na požadované súradnice</h2>
        <p>Môžete posúvať písmená doprava o požadovaný počet medzier napríklad takto:  printf(“%60cMorpheus:”, ‘ ‘);</p>
        
      </div>

      <div id="body" class="section">
        <h2>BODOVÉ OHODNOTENIE</h2>
        <p>Na získanie plného počtu bodov sa musíte dostať až po poslednú správu zo servera. Úlohy musíte mať riešené algoritmicky – predovšetkým úlohu s rozdeľovaním textu na ľavú a pravú stranu, a úlohu s prvočíslami (tie sú najvyššie bodovo hodnotené). Úloha s prvočíslami musí fungovať pre akúkoľvek dlhú správu. </p>
        
      </div>
        
    </div>
  </div>

  <script src="script.js"></script>
</body>
</html>
